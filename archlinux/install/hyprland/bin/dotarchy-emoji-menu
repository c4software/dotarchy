#!/bin/bash

# Fonction pour lire les emojis depuis le fichier statique
read_emoji_list() {
    local script_dir="$(dirname "$(readlink -f "$0")")"
    local emoji_file="$script_dir/dotarchy-emoji-list.txt"
    
    # Vérifier si le fichier existe
    if [[ ! -f "$emoji_file" ]]; then
        echo "Fichier d'emojis non trouvé : $emoji_file" >&2
        exit 1
    fi
    
    # Lire et formater les emojis (convertir "emoji description" en "emoji U+code")
    while IFS= read -r line; do
        # Ignorer les lignes vides
        [[ -z "$line" ]] && continue
        
        # Extraire l'emoji (premier caractère)
        local emoji="${line%% *}"
        
        # Calculer le code Unicode de l'emoji
        local code_point
        code_point=$(printf "%s" "$emoji" | od -An -tx4 | tr -d ' ' | tr '[:lower:]' '[:upper:]')
        
        # Afficher au format attendu par le menu
        echo "$emoji U+$code_point"
    done < "$emoji_file"
}

# Fonction principale
main() {
    # Lire les emojis depuis le fichier
    local emoji_options
    emoji_options=$(read_emoji_list)
    
    if [[ -z "$emoji_options" ]]; then
        echo "Aucun emoji disponible." >&2
        exit 1
    fi
    
    # Afficher le menu de sélection
    local selected
    selected=$(dotarchy-display-menu "Choisissez un emoji:" "$emoji_options" "-p Emoji")
    
    if [[ -n "$selected" ]]; then
        # Extraire seulement l'emoji (premier caractère avant l'espace)
        local emoji="${selected%% *}"
        
        # Copier dans le presse-papiers
        echo -n "$emoji" | wl-copy
    fi
}

# Lancer le script
main "$@"